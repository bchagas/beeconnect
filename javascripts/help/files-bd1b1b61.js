iShop.HelpCenter.Views.HelpCenterContent=Backbone.View.extend({template:HandlebarsTemplates["help_center/content"],initialize:function(){this.eventAggregator.on("render:topic",this.render,this)},render:function(e){this.$el.html(this.template(e))}}),iShop.HelpCenter.Views.HelpCenterMenu=Backbone.View.extend({template:HandlebarsTemplates["help_center/navigation"],events:{"click .topics > li > a":"getTopic","click .questions > li > span > a":"showTopics"},initialize:function(e){this.model=e.model,this.eventAggregator.on("render:result",this.getResultTopic,this)},render:function(){this.$el.html(this.template(this.model.toJSON()))},getResultTopic:function(e){var t=this;this.model.fetchCurrent({data:e,success:function(e,r){t.eventAggregator.trigger("render:topic",r)},error:function(e,r){t.eventAggregator.trigger("render:topic",r.responseText)}})},getTopic:function(e){e.preventDefault();var t=$(e.target),r=t.data("topic"),n=this;this.setCurrent(t,".topics"),this.model.fetchCurrent({data:r,success:function(e,t){n.eventAggregator.trigger("render:topic",t)},error:function(e,t){n.eventAggregator.trigger("render:topic",t.responseText)}})},showTopics:function(e){e.preventDefault();var t=$(e.target),r=t.parents("li").find("ul");this.setCurrent(t,".questions"),t.attr("href")!==r.data("target")&&this.$(".topics").slideUp(),r.slideDown()},setCurrent:function(e,t){this.$(t).find("a").removeClass("current"),e.addClass("current")}}),iShop.HelpCenter.Views.HelpCenterSearch=Backbone.View.extend({template:HandlebarsTemplates["help_center/search"],events:{"keyup input#search":"searchTopic","click button[type='submit']":"searchTopic"},initialize:function(e){this.indice=e.indice,this.index=lunr(function(){this.field("title",{boost:10}),this.ref("id"),this.field("href")})},render:function(){this.$el.html(this.template()),this.createIndex()},createIndex:function(){var e=this;_.each(this.indice,function(t){e.index.add(t)})},searchTopic:function(){var e=this,t=this.$("input#search").val(),r=this.index.search(t).map(function(t){return e.indice.filter(function(e){return e.id===parseInt(t.ref,10)})[0]});console.log(r),this.eventAggregator.trigger("render:results",r)}}),iShop.HelpCenter.Views.HelpCenterSearchResults=Backbone.View.extend({template:HandlebarsTemplates["help_center/search_results"],events:{"click .results > li":"showTopic"},initialize:function(){this.eventAggregator.on("render:results",this.render,this)},render:function(e){this.$el.html(this.template(e))},showTopic:function(e){e.preventDefault();var t=$(e.toElement).parent("li").attr("id");this.eventAggregator.trigger("render:result",t)}}),iShop.HelpCenter.Models.HelpCenter=Backbone.Model.extend({urlRoot:"/ajuda/",fetchCurrent:function(e){return e.url=this.urlRoot+e.data,Backbone.Model.prototype.fetch.call(this,e)}}),Handlebars.registerHelper("parameterize",function(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}),Handlebars.registerHelper("link",function(e,t){e=Handlebars.Utils.escapeExpression(e),t=Handlebars.Utils.escapeExpression(t);var r='<a href="'+Handlebars.helpers.parameterize(t)+'">'+e+"</a>";return new Handlebars.SafeString(r)});